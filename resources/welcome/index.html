<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="css/stylesheets.css" rel="stylesheet" type="text/css" />
        <script type='text/javascript' src='js/plugins/jquery/jquery.min.js'></script>
        <script type='text/javascript' src='js/plugins/bootstrap/bootstrap.min.js'></script>
        <script type="text/javascript">
            var skip_csel = false;
            var on_csel = false;
               $(window).on('load', function() {
                   $('#modal_default_1').modal('show');
                   $('#carousel-main').carousel({
                       interval: false
                   });
            $('#carousel-wrapper').carousel({
                       interval: false
                   });
               });
            function removeIntro(){
                if(skip_csel){
                    close();
                } else if(!on_csel) {
                    $('#carousel-wrapper').carousel('next');
                    //$("#skipbuttons").hide();
                    on_csel = true;
                }
            }

        </script>
    </head>
    <body class="bg-img-num1">
        <img id="cursor" src="cursor.webp" style="position: absolute; display:block; z-index: 9999;">
        <div class="container">
        <div class="row">
        <div class="modal" id="modal_default_1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-footer" id="skipbuttons">
                        <!-- <a href="#carousel-main" id="skipbutton1" role="button" data-slide="prev" style="padding-right:10px;" onclick="$('#carousel-main').carousel('prev')">PREVIOUS</a>
                        <a href="#carousel-main" id="skipbutton2" role="button">|</a>
                        <a href="#carousel-main" id="skipbutton3" role="button" data-slide="next" id="next" style="padding-left:10px;" onclick="$('#carousel-main').carousel('next')">NEXT</a>
                        <a href="#" onclick="removeIntro()" id="skipbutton4" style="float:left;">SKIP</a> -->
                    </div>
                    <div class="modal-body clearfix">
                        <div id="carousel-wrapper" class="carousel slide" data-ride="carousel" data-interval="false">
                            <!-- Wrapper for slides -->
                            <div class="carousel-inner" role="listbox">
                                <div class="item active" id="introslide">
                                    <div class="row">
                                        <div id="carousel-main" class="carousel slide" data-ride="carousel" data-interval="false">
                                            <!-- Wrapper for slides -->
                                            <div class="carousel-inner" role="listbox">
                                                <div class="item active">
                                                    <div class="row">
                                                        <div class="col-md-5">
                                                            <img src="img/slide-1.jpg" alt="" width="100%">
                                                        </div>
                                                        <div class="col-md-6 col-md-offset-1">
                                                            <div class="novi-introduction-text-wrap">
                                                                <div class="novi-introduction-text">
                                                                    <div class="novi-introduction-text-title"><span>Welcome to Badlands</span></div>
                                                                    <div class="novi-introduction-text-subtitle">
                                                                        <span>A microphone is required to play on this server</span>
                                                                    </div>
                                                                    <div class="novi-introduction-text-body">
                                                                        <ul>
                                                                            <li>You are expected to put effort into RP at all times</li>
                                                                            <li>You may use /ooc in chat to break character to ask a question or provide help</li>
                                                                            <li>Pressing M will open your phone (arrows to navigate, enter to select, backspace to close)</li>
                                                                            <li>Pressing U will toggle the door locks on cars you own.</li>
                                                                            <li>Pressing G will toggle your vehicle's engine state.</li>
                                                                            <li>Pressing B will toggle your ability to point</li>
                                                                            <li>Pressing ~ will toggle your voice volume</li>
                                                                            <li>Pressing X will put your hands up/down</li>
                                                                            <li>Press F5 to minimize HUD, F7 to hide player ID HUD</li>
                                                                            <li>Press K to toggle seatbelt</li>
                                                                        </ul>
                                                                        <!-- <p class="novi-introduction-text-subtitle" style="padding-top:10px;">Press NEXT for more information about life in Badlands</p> -->
                                                                    </div>
                                                                    <div class="novi-introduction-text-subtitle" style="padding-top:20px;font-size: 1.146em;">
                                                                        <span>For more information about life in Badlands, visit our forums at badlandsrp.com</span>
                                                                    </div>
                                                                    <div class="novi-introduction-text-subtitle" style="padding-top:20px;font-size: 1.146em;">
                                                                        <a href="#" class="btn btn-primary" role="button" id="skipbutton3" onclick="removeIntro()">Let's get started.</a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Controls -->
                                        </div>
                                    </div>
                                </div>

                                <div class="item" id="charslide">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="novi-introduction-text-wrap">
                                                <div class="novi-introduction-text">
                                                    <div class="novi-introduction-text-title col-md-12"><span>Select a Character</span></div>
                                                    <div class="novi-introduction-text-body" id="charlist">
                                                        <!-- character list-->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="item" id="loadingslide2">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="novi-introduction-text-wrap">
                                                <div class="novi-introduction-text">
                                                    <div class="novi-introduction-text-title col-md-12 text-center"><span>Loading</span></div>
                                                    <div class="novi-introduction-text-body text-center">
                                                        <img src="https://badlandsrp.com/cdn/fivem/rolling.svg" alt="...">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Controls -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            var documentWidth = document.documentElement.clientWidth;
            var documentHeight = document.documentElement.clientHeight;

            var cursor = document.getElementById("cursor");
            var cursorX = documentWidth / 2;
            var cursorY = documentHeight / 2;

            function UpdateCursorPos() {
                $(cursor).css('left', cursorX)
                $(cursor).css('top', cursorY)
            }

            function Click(x, y) {
                var element = $(document.elementFromPoint(x - window.pageXOffset, y - window.pageYOffset));
                element.focus().click();
            }

            function testmessage(message){
                $.post('http://welcome/testmessage', JSON.stringify({text:message}));
            }

            function close(){
                $('body').fadeOut(function(){
                    $.post('http://welcome/escape', JSON.stringify({}));
                });
            }

            function chooseChar(char){
            //$('body').fadeOut('slow');
            $.post('http://welcome/chooseChar', JSON.stringify({char:char}));
            }

            function deleteChar(char){
            //$('body').fadeOut('slow');
            $.post('http://welcome/deleteChar', JSON.stringify({char:char}));
            }

            function ready(){
                $.post('http://welcome/ready', JSON.stringify({}));
            }

            function appendEmptyCharacter(){
                var template =
                '<div class="col-sm-6 col-md-4">'+
                    '<div class="thumbnail" style="padding-top:10px;">'+
                        '<img src="https://badlandsrp.com/cdn/fivem/avatars/default.png" alt="...">'+
                        '<div class="caption text-center">'+
                            '<h3>Empty Slot</h3>'+
                            '<p><a href="#" class="btn btn-primary" role="button" id="createchar">Create Character</a></p>'+
                        '</div>'+
                    '</div>'+
                '</div>';
                $("#charlist").append(template);
            }

            $(document).ready(function() {
               //$("#skipbuttons").hide();
               $(cursor).css('display', "none");
               //setTimeout(function(){ ready(); }, 3000);
               ready();
            });

            $(function() {
                window.addEventListener('message', function(event) {
                        if (event.data.type == "enableui") {
                            //$('#carousel-wrapper').carousel('next');
                            //$("#skipbuttons").show();
                            $(cursor).css('display', event.data.enable ? "block" : "none");
                            $("body").css('display', event.data.enable ? "block" : "none");
                            $("body").css('background', event.data.enable ? "black" : "none");

                        } else if (event.data.type == "click") {
                            // Avoid clicking the cursor itself, click 1px to the top/left;
                            Click(cursorX - 1, cursorY - 1);
                        } else if (event.data.type == "chardata") {
                            characters = JSON.parse(event.data.chars);
                            for(i = 0; i < characters.length; i++ ){
                                var character = characters[i];
                                var template =
                                '<div class="col-sm-6 col-md-4" id="char_'+character.id+'">'+
                                    '<div class="thumbnail" style="padding-top:10px;">'+
                                        '<img src="https://badlandsrp.com/cdn/fivem/avatars/default.png" alt="...">'+
                                        '<div class="caption text-center">'+
                                            '<h3>'+character.firstname+' '+character.lastname+'</h3>'+
                                            '<p><a href="#" class="btn btn-primary" role="button" id="choosechar" char="'+character.id+'">Select</a> <a href="#" class="btn btn-danger" role="button" id="deletechar" char="'+character.id+'">Delete</a></p>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>';
                                $("#charlist").append(template);
                            }
                            for(i = characters.length; i < 3; i++ ){
                                appendEmptyCharacter();
                            }
                            // else {
                            //     skip_csel = true;
                            // }
                        } else if (event.data.type == "close"){
                            close()
                        }
                });

                $(document).on("click", "#choosechar", function(e){
                    $('#carousel-wrapper').carousel('next');
                    char = $(this).attr("char");
                    chooseChar(char);
                });

                $(document).on("click", "#createchar", function(e){
                    let html = `
                    <form>
        				<input name="firstname" type="text" placeholder="First name"><br>
        				<input name="lastname" type="text" placeholder="Last name"><br>
        				<input name="dateofbirth" type="number" min="18" max="120" placeholder="Age (18-120)"><br>
        				<input name="height" type="number" min="140" max="200" placeholder="Height (140-200 cm)">
                        <div class="radio">
                          <label>
                            <input type="radio" name="sex" id="optionsRadios1" value="m" style="-webkit-box-shadow: none;box-shadow: none;" checked>
                            Male
                          </label>
                        </div>
                        <div class="radio">
                          <label>
                            <input type="radio" name="sex" id="optionsRadios2" style="-webkit-box-shadow: none;box-shadow: none;" value="f">
                            Female
                          </label>
                        </div>
        				<a href="#" class="btn btn-primary" role="button" id="finishchar">Create Character</a>
        			</form>
                    `;
                    $(this).closest('.thumbnail').html(html);
                });

                $(document).on("click", "#deletechar", function(e){
                        char = $(this).attr("char");
                        if($("a[id^=deletechar]").length > 1){
                            if(confirm("Deleting this character will permanently remove all of its inventory, weapons, aptitudes, and customizations. Are you sure you wish to proceed?")){
                                deleteChar(char);
                                $("#char_"+char).fadeOut("normal", function() {
                                    $(this).remove();
                                    appendEmptyCharacter();
                                });
                            }
                        } else {
                            alert("You cannot delete your only character. Visit City Hall to create a new one.");
                        }
                });

                $(document).on("click", "#finishchar", function(e){
                        let data = {};
                        $(this).parent().serializeArray().map(function(x){data[x.name] = x.value;});

                        let pattern = new RegExp('^[a-zA-Z]+$');
                        if(!pattern.test(data.firstname)){
                            return alert("Invalid First Name");
                        }
                        if(!pattern.test(data.lastname)){
                            return alert("Invalid Last Name");
                        }
                        if(data.dateofbirth < 18 || data.dateofbirth > 120){
                            return alert("Invalid Age");
                        }
                        if(data.height < 140 || data.dateofbirth > 200){
                            return alert("Invalid Height");
                        }
                        if(data.sex != "m" && data.sex != "f"){
                            return alert("Invalid Sex");
                        }

                        $('#carousel-wrapper').carousel('next');
                        $.post('http://welcome/createChar', JSON.stringify({char:data}));
                });

                $(document).mousemove(function(event) {
                        cursorX = event.pageX;
                        cursorY = event.pageY;
                        UpdateCursorPos();
                });

                document.onkeyup = function (data) {
                        if (data.which == 27) { // Escape key
                                removeIntro();
                        }
                };
            });
        </script>
    </body>
</html>
