<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- Bootstrap Core CSS -->
      <link href="css/bootstrap.min.css" rel="stylesheet">
      <!-- Custom CSS -->
      <link href="css/shop-homepage.css" rel="stylesheet">
      <script src="js/jquery.js" type="text/javascript"></script>
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
   </head>
   <body>
      <img id="cursor" src="cursor.webp" style="position: absolute; display:none; z-index: 99;">
      <!-- Navigation -->
      <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" style='z-index: 1'>
         <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
               <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
               <span class="sr-only">Toggle navigation</span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               </button>
               <b class="navbar-brand">Press ESC to close.</b>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
               <ul class="nav navbar-nav">
                  <li>
                     <!--<a href="#" style='' id='select-cat-home'>Home</a>-->
                  </li>
               </ul>
            </div>
            <!-- /.navbar-collapse -->
         </div>
         <!-- /.container -->
      </nav>
      <!-- Page Content -->
      <div class="container">
      <div class="row">
         <div class="col-md-3">
            <p class="lead">Categories</p>
            <div class="list-group">
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-home'>Home</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-job'>Job Vehicles</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-compacts'>Compact Cars</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-coupe'>Coupes</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-sports'>Sports Cars</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-sportsclassics'>Sports Classic Cars</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-musclecars'>Muscle Cars</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-supercars'>Super Cars</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-off-road'>Offroad Vehicles</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-suvs'>SUVs</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-vans'>Vans</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-sedans'>Sedans</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-motorcycles'>Motorcycles</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-taxi'>Taxis</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-police'>Police Vehicles</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-emergency'>Emergency Vehicles</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-bicycles'>Bicycles</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-boats'>Boats</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-emergencyboats'>Emergency</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-planes'>Planes</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-helicopters'>Helicopters</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-emergencyair'>Emergency</a>
               <a href="#" style="border-radius: 0;" class="list-group-item" id='select-cat-arena'>Arena Vehicles</a>
            </div>
         </div>
         <div class="col-md-8">
            <div id="home" class="row carousel-holder">
               <div class="col-md-12">
                  <div class="jumbotron">
                     <h2><b>Your Garage</b></h2>
                     <p>Welcome to your garage! Here you can purchase vehicles and retrieve the ones you already own from the garage. Select a category to begin!</p>
                     <p><button type="button" class="btn btn-danger btn-lg btn-block" id="store-vehicle">Store Vehicle in Garage</button></p>
                  </div>
               </div>
            </div>
            <div class="row">
               <div id="job-vehicles">
               </div>
               <div id="compacts-vehicles">
               </div>
               <div id="coupe-vehicles">
               </div>
               <div id="sports-vehicles">
               </div>
               <div id="sportsclassics-vehicles">
               </div>
               <div id="musclecars-vehicles">
               </div>
               <div id="supercars-vehicles">
               </div>
               <div id="off-road-vehicles">
               </div>
               <div id="suvs-vehicles">
               </div>
               <div id="vans-vehicles">
               </div>
               <div id="sedans-vehicles">
               </div>
               <div id="motorcycles-vehicles">
               </div>
               <div id="taxi-vehicles">
               </div>
               <div id="police-vehicles">
               </div>
               <div id="emergency-vehicles">
               </div>
               <div id="bicycles-vehicles">
               </div>
               <div id="boats-vehicles">
               </div>
               <div id="emergencyboats-vehicles">
               </div>
               <div id="planes-vehicles">
               </div>
               <div id="helicopters-vehicles">
               </div>
               <div id="emergencyair-vehicles">
               </div>
               <div id="arena-vehicles">
               </div>
            </div>
         </div>
      </div>
      <!-- /.container -->
      <div class="container">
         <hr>
         <!-- Footer -->
         <footer>
            <div class="row">
               <div class="col-lg-12">
                  <p>Copyright &copy; 2nd Chance Auto</p>
               </div>
            </div>
         </footer>
      </div>
      <!-- /.container -->
      <!-- jQuery -->
      <script src="js/jquery.js"></script>
      <!-- Bootstrap Core JavaScript -->
      <script src="js/bootstrap.min.js"></script>
      <script>
         var documentWidth = document.documentElement.clientWidth;
         var documentHeight = document.documentElement.clientHeight;

         var cursor = document.getElementById("cursor");
         var cursorX = documentWidth / 2;
         var cursorY = documentHeight / 2;

         function UpdateCursorPos() {
             $(cursor).css('left', cursorX)
             $(cursor).css('top', cursorY)
         }

         function Click(x, y) {
             var element = $(document.elementFromPoint(x - window.pageXOffset, y - window.pageYOffset));
             element.focus().click();
         }

         function buyVehicle(gar,veh){
            $.post('http://es_carshop/buy_vehicle', JSON.stringify({garage:gar,vehicle: veh}));
         }

         function sellVehicle(gar,veh){
            $.post('http://es_carshop/sell_vehicle', JSON.stringify({garage:gar,vehicle: veh}));
         }

        function testmessage(message){
            $.post('http://es_carshop/testmessage', JSON.stringify({text:message}));
         }

         $(function() {
            $(cursor).css('display', "none")
            $("body").css('display', "none")
            $("body").css('background', 'none')
             window.addEventListener('message', function(event) {
                 if (event.data.type == "enableui") {
                     $(cursor).css('display', event.data.enable ? "block" : "none")
                     $("body").css('display', event.data.enable ? "block" : "none")
                     $("body").css('background', event.data.enable ? "white" : "none")
                     selectCat("home")

                 } else if (event.data.type == "click") {
                     // Avoid clicking the cursor itself, click 1px to the top/left;
                     Click(cursorX - 1, cursorY - 1);
                 } else if (event.data.type == "vehicles") {
                       for(var i in event.data.enable) {
                           $("#veh_" + i).find(".caption").find(".price").append(" (Owned)")
                           $("#veh_" + event.data.garage + "_" + event.data.vehicle).find(".buysell").find(".btn-success").html("Retrieve")
                           $("#veh_" + event.data.garage + "_" + event.data.vehicle).find(".buysell").find(".btn-danger").removeClass("btn-outline-danger");
                       }
                   } else if (event.data.type == "vehicle") {
                       $("#veh_" + event.data.garage + "_" + event.data.vehicle).find(".caption").find(".price").append(" (Owned)")
                       $("#veh_" + event.data.garage + "_" + event.data.vehicle).find(".buysell").find(".btn-success").html("Retrieve")
                       $("#veh_" + event.data.garage + "_" + event.data.vehicle).find(".buysell").find(".btn-danger").removeClass("btn-outline-danger");
                   } else if (event.data.type == "vehicleList") {
                       $("[id^=select-cat-]").hide();
                       $("#select-cat-home").show();
                       $("[id^=veh_]").remove();
                       garages = JSON.parse(event.data.vehicles)
                       for(var garage in garages) {
                           $('#select-cat-'+garage).show();
                           var carGarage = garages[garage]
                           Object.keys(carGarage).sort(function(a,b){return carGarage[a][1]-carGarage[b][1]}).forEach(function(car) {
                             var template = '<div class="col-sm-4 col-lg-4 col-md-4" id="veh_'+garage+'_'+car+'">' +
                                               '<div class="thumbnail">' +
                                                   '<img src="http://badlandsrp.com/cdn/fivem/es_carshop/cars/'+car+'.webp" style="max-width:270px;max-height:152px" alt="">' +
                                                   '<div class="caption">' +
                                                       '<h4><b>'+garages[garage][car][0]+'</b></h4>' +
                                                       '<h4 class="price">$'+garages[garage][car][1].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")+'</h4>' +
                                                       '<div style="word-wrap: break-word;">'+garages[garage][car][2]+'</div>'+
                                                   '</div>' +
                                                   '<div class="ratings">' +
                                                       '<p class="pull-right">'+(Math.floor(Math.random()*124)+1)+' reviews</p>' +
                                                       '<p>' +
                                                           '<span class="glyphicon glyphicon-star"></span>' +
                                                           '<span class="glyphicon glyphicon-star"></span>' +
                                                           '<span class="glyphicon glyphicon-star"></span>' +
                                                           '<span class="glyphicon glyphicon-star"></span>' +
                                                       '</p>' +
                                                   '</div>' +
                                                   '<div class="buysell clearfix">'+
                                                      '<p class="col-sm-6 col-lg-6 col-md-6"><button type="button" class="btn btn-success btn-block" id="buy_'+garage+'_'+car+'">Purchase</button></p>'+
                                                      '<p class="col-sm-6 col-lg-6 col-md-6"><button type="button" class="btn btn-danger btn-outline-danger btn-block" id="sell_'+garage+'_'+car+'">Sell</button></p>'+
                                                    '</div>' +
                                               '</div>' +
                                           '</div>'
                             $("#"+garage+"-vehicles").append(template);
                           });
                       }
                   }
             });

             $(document).mousemove(function(event) {
                 cursorX = event.pageX;
                 cursorY = event.pageY;
                 UpdateCursorPos();
             });

             document.onkeyup = function (data) {
                 if (data.which == 27) { // Escape key
                     $.post('http://es_carshop/escape', JSON.stringify({}));
                 }
             };

               $(document).on("click", "[id^=buy_]", function(e){
                   vehicle = $(this).attr("id").split('_')
                   buyVehicle(vehicle[1],vehicle[2])
               });

               $(document).on("click", "[id^=sell_]:not([class*='btn-outline-danger'])", function(e){
                   vehicle = $(this).attr("id").split('_')
                   sellVehicle(vehicle[1],vehicle[2])
               });

                // Tabs

                function hide(){
                    $("#home").css('display', 'none')
                    $("[id$=-vehicles]").css('display', 'none')
                }
                hide()

                function selectCat(cat){
                    hide()
                 if(cat == "home"){
                   $("#home").css('display', 'block')
                 } else {
                   $("#"+cat+"-vehicles").css('display', 'block')
                 }
                }
                selectCat("home")

               $('#store-vehicle').click(function(){ $.post('http://es_carshop/storeVehicle', JSON.stringify({})); })

               $('#select-cat-home').click(function(){ selectCat("home") })
               $('#select-cat-job').click(function(){ selectCat("job") })
               $('#select-cat-compacts').click(function(){ selectCat("compacts") })
               $('#select-cat-coupe').click(function(){ selectCat("coupe") })
               $('#select-cat-sports').click(function(){ selectCat("sports") })
               $('#select-cat-sportsclassics').click(function(){ selectCat("sportsclassics") })
               $('#select-cat-musclecars').click(function(){ selectCat("musclecars") })
               $('#select-cat-supercars').click(function(){ selectCat("supercars") })
               $('#select-cat-off-road').click(function(){ selectCat("off-road") })
               $('#select-cat-suvs').click(function(){ selectCat("suvs") })
               $('#select-cat-vans').click(function(){ selectCat("vans") })
               $('#select-cat-sedans').click(function(){ selectCat("sedans") })
               $('#select-cat-motorcycles').click(function(){ selectCat("motorcycles") })
               $('#select-cat-taxi').click(function(){ selectCat("taxi") })
               $('#select-cat-police').click(function(){ selectCat("police") })
               $('#select-cat-emergency').click(function(){ selectCat("emergency") })
               $('#select-cat-bicycles').click(function(){ selectCat("bicycles") })
               $('#select-cat-boats').click(function(){ selectCat("boats") })
               $('#select-cat-emergencyboats').click(function(){ selectCat("emergencyboats") })
               $('#select-cat-planes').click(function(){ selectCat("planes") })
               $('#select-cat-helicopters').click(function(){ selectCat("helicopters") })
               $('#select-cat-emergencyair').click(function(){ selectCat("emergencyair") })
               $('#select-cat-arena').click(function(){ selectCat("arena") })
         });
      </script>
   </body>
</html>
